<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Daniel Kaplan">
<meta name="dcterms.date" content="2023-08-16">

<title>Math300 Blog - Instructor’s Orientation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Math300 Blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://dtkaplan.github.io/Math-300Z/" rel="" target="">
 <span class="menu-text">Spring 2023 class schedule</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Instructor’s Orientation</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">p-values</div>
                <div class="quarto-category">significance</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Daniel Kaplan </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">August 16, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#improving-stat-101" id="toc-improving-stat-101" class="nav-link active" data-scroll-target="#improving-stat-101">Improving Stat 101</a></li>
  <li><a href="#foundations-in-lessons" id="toc-foundations-in-lessons" class="nav-link" data-scroll-target="#foundations-in-lessons">Foundations in <em>Lessons</em></a></li>
  <li><a href="#accessible-computing" id="toc-accessible-computing" class="nav-link" data-scroll-target="#accessible-computing">Accessible computing</a></li>
  <li><a href="#stat-101" id="toc-stat-101" class="nav-link" data-scroll-target="#stat-101">Stat 101</a></li>
  <li><a href="#p-values-and-causation" id="toc-p-values-and-causation" class="nav-link" data-scroll-target="#p-values-and-causation">P values and causation</a></li>
  <li><a href="#taken-out" id="toc-taken-out" class="nav-link" data-scroll-target="#taken-out">Taken out</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block page-columns page-full" id="quarto-document-content">




<p>To judge from the tables of contents of the most widely used introductory statistics texts, there is strong consensus about the appropriate topics to include in a university-level introduction to statistics, a course we will label “Stat 101.” Yet there remains considerable dis-enchantment with Stat 101. Among these: a semester course is too crowded with topics; there is too much algebra; there is too strong an emphasis on p-values. Leading statistics educators, such as the 11 authors of the <a href="https://www.amstat.org/asa/files/pdfs/GAISE/GaiseCollege_Full.pdf">2016 American Statistical Association <em>Guidelines for Assessment and Instruction in Statistics Education</em> (GAISE) College Report</a>) point to stresses placed on the introductory course from two directions: first, the increasing coverage of statistics in grades 6-12 and, second, the emergence of data science as the paradigm for real-world professional work with data.</p>
<p>There has been incremental progress in addressing the shortcomings of Stat 101. Much of this progress fall under four themes.</p>
<ol type="1">
<li>Increasing use of computing as a modality for introducing statistical concepts.</li>
<li>Greater emphasis on “real data” and short, student-directed investigatory projects.</li>
<li>The greater conceptual clarity and accessibility of randomization-based approaches to statistical inference, particularly bootstrapping and permutation tests.</li>
<li>The emergence of free, online, open-source texts that compare favorably to publisher-directed commercial texts. Among these are [Hardin and Cetinskaya], [OpenStax], [OpenIntro], [ModernDive].</li>
</ol>
<p>In many ways, the free, online texts are the engine for innovation. They are typically produced by one or two statistics educators working independently of any publisher and motivated not to capture a paying market but to advance statistics education. In contrast, publishers are conservative in their choice of topics and technology, seeming with the goal of not alienating their current client base. [Notable exceptions include the Lock<sup>5</sup> and Tintle texts.]{aside} Instructors recognize that the next edition of a textbook will be different only in superficial ways from the previous editions. One text, widely used in two-year colleges and broadly disparaged in other contexts, is in its thirteenth edition. The first edition appeared in 1980.</p>
<p>One of the most highly regarded statistics educators of the last 30 years, George Cobb, entitled a <a href="https://arxiv.org/abs/1507.05346">2015 paper</a> “Mere Renovation is Too Little Too Late: We Need to Rethink Our Undergraduate Curriculum from the Ground Up.” But ground-up innovation is problematic. It calls for heroic effort by statistics instructors to learn new topics and tools. More subtly, in order to teach a coherent course where topics build on one another and reinforce one another, instructors have to develop a feel for the connections among the initially unfamiliar topics.</p>
<p>Those who advocate a ground-up innovation ultimately have to face an ethical formula: <a href="https://en.wikipedia.org/wiki/Ought_implies_can">“Ought implies can.”</a>. The innovator must reach past the arguments for innovation to demonstrate that a ground-up innovation is a feasible way to teach introductory statistics, <em>including data science</em>. In my view, one also has to recognize the constraints imposed by other aspects of the educational system. Although a one-semester statistics course is one of the most widespread requirements across university disciplines, there is little advocacy among non-statisticians for a heavier, longer requirement. Similarly, the successful statistics course cannot call for extensive pre- or co-requisites in computing or mathematics.</p>
<p><em>Lessons in Statistical Thinking</em> is my attempt to go beyond outlining ground-up innovation to a living, breathing, complete course. The purpose of this <em>Orientation</em> is to help instructors understand the overall structure of the course, the reasons for including some topics and excluding others, and to highlight some of the innovations that make the course a feasible option for many statistics instructors.</p>
<section id="improving-stat-101" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="improving-stat-101">Improving Stat 101</h2>
<p>An excellent summary of how to improve Stat 101 is provided by Jeff Witmer’s <a href="https://doi.org/10.1080/26939169.2023.2205905">2023 article</a> in the <em>Journal of Statistics and Data Science Education</em>, “What should we do differently in STAT 101?” Witmer, one of the authors of the 2016 GAISE report, proposes fifteen changes for Stat 101, placing them in three categories:</p>
<ol type="a">
<li>Changes you could make with little effort or planning.</li>
<li>Changes that you could implement with the investment of a day or two of planning.</li>
<li>Changes that require “quite a bit of planning but that are worth considering nonetheless.”</li>
</ol>
<p>Witmer provides a discussion of each of the fifteen changes, an extremely useful reference for the reader who might not be familiar with terms like causal diagrams, causal diagrams, effect size, etc. For ease of reference, I retain Witmer’s numbering system in the short summaries that follow.</p>
<p><strong>Paradigm for statistical description</strong></p>
<ul>
<li><ol start="4" type="1">
<li>Use the use the framework of response variable versus predictor variables. (Category a.) </li>
</ol></li>
<li><ol start="5" type="1">
<li>Use more modeling and estimation and less formal inference. (b.)</li>
</ol></li>
<li><ol start="10" type="1">
<li>Talk about effect size. (c.)</li>
</ol></li>
<li><ol start="8" type="1">
<li>Use logistic regression when modeling a categorical response variable with two levels. (b.)</li>
</ol></li>
<li><ol start="12" type="1">
<li>Present causal diagrams. (c.)</li>
</ol></li>
<li><ol start="13" type="1">
<li>Include more emphasis on prediction. (c.)</li>
</ol></li>
<li><ol start="14" type="1">
<li>Be explicit about how to adjust for a confounder and the Cornfield conditions. (c.)</li>
</ol></li>
<li><ol start="15" type="1">
<li>Teach Berkson’s paradox. In terms of causal diagrams, this corresponds to a collider. (c.)</li>
</ol></li>
</ul>
<div class="no-row-height column-margin column-container"><span class="">In <em>Lessons</em>, I prefer “explanatory variable” rather than “predictor variable but there is no real difference.</span></div><p><strong>Changes concerning statistical inference</strong></p>
<ul>
<li><ol type="1">
<li>Replace “statistically significant” with “statistically discernible.” (Category a.)</li>
</ol></li>
<li><ol start="2" type="1">
<li>Report p-values to only 2 or 3 decimal places. (a.)</li>
</ol></li>
<li><ol start="3" type="1">
<li>Refer to “conditions” that can potentially be checked rather than “assumptions” that may or may not be relevant to a real-world context. (a.)</li>
</ol></li>
<li><ol start="6" type="1">
<li>Include “power” and other aspects of the Neymann-Pearson approach, rather than just Null Hypothesis Significance Testing. (b.)</li>
</ol></li>
<li><ol start="7" type="1">
<li>Cover the inference of relative risk, e.g.&nbsp;<span class="math inline">\(p_1 / p_2\)</span>. Also, 9. consider teaching about paired proportions (b.)</li>
</ol></li>
<li><ol start="10" type="1">
<li>(continued) Show that a test statistic is an effect size multiplied by a sample size inflation. (c.) Example: The effect size corresponding to <span class="math inline">\(R^2\)</span> is <span class="math inline">\(R^2 / (1- R^2)\)</span> while the sample size inflation is <span class="math inline">\(\frac{n - (k+1)}{k}\)</span>, that is, <span class="math display">\[F \equiv \frac{R^2}{1-R^2} \frac{n - (k+1)}{k}\ .\]</span></li>
</ol></li>
<li><ol start="11" type="1">
<li>Teach about the perils of multiple testing and about the “garden of forking paths.” (c.)</li>
</ol></li>
</ul>
<p>The topics and practices in categories (a) and (b) fit easily into the 1-semester Stat 101. But many of the category-(c) topics require surgery on Stat 101: making space for new topics by removing or consolidating some traditional topics.</p>
<p><em>Lessons</em> touches on all fifteen of Witmer’s suggested Stat 101 topics and practices. But <em>Lessons</em> does not merely swap out old topics for new. Rather, <em>Lessons</em> provides new foundations on which a modern statistical edifice can be constructed.</p>
</section>
<section id="foundations-in-lessons" class="level2">
<h2 class="anchored" data-anchor-id="foundations-in-lessons">Foundations in <em>Lessons</em></h2>
</section>
<section id="accessible-computing" class="level2">
<h2 class="anchored" data-anchor-id="accessible-computing">Accessible computing</h2>
<hr>
<p><em>Lessons in Statistical Thinking</em> is an introductory textbook that is, like most textbooks, oriented to students. Students come to the book with fresh minds, unaware of the history that leads some topics to be emphasized and others to be minimized or entirely excluded.</p>
<p>For instructors, however, that history plays an important role in setting attitudes and expectations. Instructors have already studied statistics—sometimes learning it from the textbook they teach from!—and have pre-formed opinions about which topics ought to be included in an introduction to statistics. This orientation seeks to explain to instructors the unconventional choices made in <em>Lessons</em> and highlight the important connections between subjects that might not yet be familiar to the instructor contemplating using <em>Lessons</em> as a course text.</p>
</section>
<section id="stat-101" class="level2">
<h2 class="anchored" data-anchor-id="stat-101">Stat 101</h2>
<p>Many readers have had experience teaching a conventional introductory course. A first step in understanding the choices made in putting together the <em>Lessons</em> text is to become aware of the problems and deficiencies of the conventional approach. For brevity, we’ll use the name “Stat 101” to label the conventional practices that are so widely used that they can be taken as the consensus view.</p>
<p>A widely held opinion among instructors is that there is already so much material in Stat 101 that there is no room for including even important new topics such as adjusting for covariates, causal inference, or data-science skills and techniques. This over-crowding becomes a deficiency in Stat 101 when you consider alternative approaches that can substantially streamline the Stat 101 material.</p>
<p>Another deficiency has to do with the emphasis on p-values found in Stat 101. Typically, about one-third of the course focuses on statistical tests. The American Statistical Association has called for a de-emphasis on p-values [CITATION HERE], recognizing the many ways they are routinely misused. For instance, the ASA statement states that “a p-value does not provide a good measure of evidence regarding a model or hypothesis.” This statement, widely accepted in the professional community, is incomprehensible to many Stat-101 teachers. (You can judge for yourself whether or not the ASA statement is reflected in the orientation of your own teaching.)</p>
<p>The <a href="https://www.amstat.org/asa/files/pdfs/GAISE/GaiseCollege_Full.pdf">2016 American Statistical Association <em>Guidelines for Assessment and Instruction in Statistics Education</em> (GAISE) College Report</a>) includes a section on “suggestions for topics that might be omitted from introductory statistics courses.” These include probability theory and drills with “<span class="math inline">\(z\)</span>-, <span class="math inline">\(t\)</span>-, <span class="math inline">\(\chi^2\)</span>, and <span class="math inline">\(F\)</span>-tables.” For instance, early discussions by the committee charged by the American Statistical Association with updating the GAISE report favored dividing the widely accepted requirement for statistics into two courses, one in statistics, the other in data science. My own opinion is that such an expansion of requirements is likely to be rejected as overly burdensome by many programs. this is both impractical and unnecessary. Few departments that</p>
<p>First and foremost is the divergence of professional statistical practice from the topics of Stat 101. Quantities and methods routinely found in the applied research literature are often not even hinted at in Stat 101.</p>
<p>: the intentional omission of many Stat-101 topics and the inclusion of other topics that never found space in the Stat-101 canon or that violated the <em>ethos</em> that historically that course.</p>
<ul>
<li>Tests versus models</li>
</ul>
</section>
<section id="p-values-and-causation" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="p-values-and-causation">P values and causation</h2>
<p>Statistics instructors very often have their knowledge base shaped by the introductory books from which they teach. What’s in the books, rather than what’s useful or needed, is the operational definition of the field. This book drops many traditional methods and introduces important methods used in contemporary work with data. A little background may help instructors new to this book in understanding two major decisions shaping that book. They both have to do with what is called “statistical inference,” reasoning from data to the broader world: first, minimizing the role in this book of p-values; second, taking causality seriously.</p>
<p>There are dozens of introductory statistics textbooks, many in their tenth or fifteenth editions. Unfortunately, the topics of traditional introductory statistics texts have long been obsolescent and fail to address the needs of the contemporary data scientist and decision-maker. The traditional canon stems from an influential 1925 book, Ronald Fisher’s <em>Statistical Methods for Research Workers</em>. Research workers of that era typically ran small benchtop or field experiments with a dozen or fewer observations on each of two treatments. A first task with such small data is to rule out the possibility that calculated differences might reflect only the accidental arrangement of numbers into groups. This task was given the odd name “significance testing” and is at the core of most statistics textbooks.</p>
<p>Unfortunately, significance testing has little to do with the everyday meaning of “significant” as “important” or “relevant.” <a href="www/d41586-019-00857-9.pdf">This article</a> in the prestigious science journal <em>Nature</em> details the controversy. <a href="#fig-nature-significance">Figure&nbsp;1</a> reproduces a cartoon from that article that puts the shortcomings of “statistical significance” in a historical context.</p>
<div class="cell page-columns page-full">
<div class="cell-output-display page-columns page-full">
<div id="fig-nature-significance" class="quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="www/Significance-cartoon.png" class="img-fluid figure-img" width="610"></p>
<figcaption class="figure-caption margin-caption">Figure&nbsp;1: A cartoon published along with an article in <em>Nature</em>, “Retire statistical significance,” showing this once-respected idea heading to the graveyard for outdated and misleading “scientific” concepts such as phlogiston and aether.</figcaption>
</figure>
</div>
</div>
</div>
<p>Obsession with the mantra, “Correlation is not causation,” is another sign of the obsolescence of the traditional introduction to statistics. Around 1910, the pioneers of statistics were the first to emphasize an important innovation in scientific method: the randomized controlled trial (RCT). Adoption of the RCT in the twentieth century put several branches of science on a new footing. And many statistics instructors see “correlation is not causation” as a slogan pointing to the genuine importance of RCTs. Unfortunately, the mantra has been over-interpreted to mean the impossibility of causal knowledge without RCTs, as in the following cartoon (<a href="#fig-xkcd-correlation">Figure&nbsp;2</a>):</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-xkcd-correlation" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="www/xkcd-correlation.png" class="img-fluid figure-img" width="459"></p>
<figcaption class="figure-caption">Figure&nbsp;2: <a href="https://xkcd.com/552/">XKCD’s take</a> on correlation and causation.</figcaption>
</figure>
</div>
</div>
</div>
<p>Nowadays, when data are used to inform policy decisions in many areas, being statistically literate includes the need to make justifiable conclusions about causality. One approach to this was highlighted by the <a href="https://www.nobelprize.org/prizes/economic-sciences/2019/press-release/">2019 Nobel Prize</a> in economics; breaking down complex issues of global poverty into smaller, more manageable questions where an RCT is feasible. Another approach, using “natural experiments” was honored by the <a href="https://www.nobelprize.org/prizes/economic-sciences/2021/press-release/">2021 Nobel Prize</a>.</p>
<p>There is no Nobel in computer science. The equivalent is the <a href="https://amturing.acm.org/award_winners/pearl_2658896.cfm">Turing Award, which in 2011</a> was awarded for “fundamental contributions to … probabilistic and causal reasoning.” That such prestigious awards are being given in the last decade demonstrates how recent and how important causal reasoning is and why the fundamentals of causality ought to be part a modern introduction to statistics. Consequently, they are a major theme in these Lessons.</p>
</section>
<section id="taken-out" class="level2">
<h2 class="anchored" data-anchor-id="taken-out">Taken out</h2>
<p>To set the stage, consider some of the ways <em>Lessons</em> is different from the conventional introductory statistics.</p>
<ol type="1">
<li><p><em>Lessons</em> starts with a brief introduction to those elements of <em>data science</em> that provide access to the sorts of data commonly encountered today. It is here that computing is introduced. The new instructor will reasonably wonder whether data-science computing is accessible to her students. <strong>?@sec-simplifying-computing</strong> provides the necessary introduction to instructors. Based on this introduction, an instructor can shape an informed opinion about accessibility.</p></li>
<li><p><em>Lessons</em> uses statistical modeling as the core framework for quantifying patterns in data. The modeling approach has two advantages: it actually simplifies the presentation of the many tests found in a conventional introduction; and it provides the means to put covariation and multivariable thinking at the center of the course. (“Multivariable thinking” is one of the primary emphases in the <a href="https://www.amstat.org/asa/files/pdfs/GAISE/GaiseCollege_Full.pdf">2016 American Statistical Association <em>Guidelines for Assessment and Instruction in Statistics Education</em> (GAISE) College Report</a>.)</p></li>
</ol>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>